<!-- Teacher Attendance Notification Alert Created by Chad Cole -->
<style type="text/css" title="text/css">
	.tanwidth { max-width: 640px; }
</style>

<div class="box-round tanwidth" id="alert-attendance~(studentfrn)">
	<p class="alertHeader">Attendance Information for ~(studentname)</p>
	<p>There are attendance records recorded for this student for today, ~(gpv.att_date)</p>
	<p><b>Meeting Attendance:</b></p>
	<table class="linkDescList">
			<thead>
					<tr>
							<th>Period</th>
							<th>Course</th>
							<th style="text-align: center;">Code</th>
							<th style="text-align: center;">Status</th>
							<th>Comment</th>
					</tr>
			</thead>
			<tbody>
					~[tlist_sql;
							select se.external_expression, c.course_name, pam.att_code, pam.presence_status_cd, pam.att_comment
							from pssis_attendance_meeting pam
							inner join sections se on pam.sectionid = se.id
							inner join courses c on se.course_number = c.course_number
							where pam.studentid =  ~(curstudid)
								and pam.att_date = to_date('~(gpv.att_date;sqlText)','~[datetext:mmddyyyy]')
							order by se.expression;nonemessage=<tr><td colspan="100%">There are no meeting attendance codes recorded for today.</td></tr>]
					<tr>
							<td>~(se.external_expression)</td>
							<td>~(c.course_name)</td>
							<td style="text-align: center;">~(pam.att_code)</td>
							<td style="text-align: center;">~(pam.presence_status_cd)</td>
							<td>~(pam.att_comment)</td>
					</tr>
					[/tlist_sql]
			</tbody>
	</table>
	<p><b>Daily Attendance:</b></p>
	<table class="linkDescList">
			<thead>
					<tr>
							<th>Code</th>
							<th>Status</th>
							<th>Comment</th>
					</tr>
			</thead>
			<tbody>
					~[tlist_sql;
							select pad.att_code, pad.presence_status_cd, pad.att_comment
							from pssis_attendance_daily pad
							where pad.studentid =  ~(curstudid)
								and pad.att_date = to_date('~(gpv.att_date;sqlText)','~[datetext:mmddyyyy]');nonemessage=<tr><td colspan="100%">There is no daily attendance code recorded for today.</td></tr>]
					<tr>
							<td>~(pad.att_code)</td>
							<td>~(pad.presence_status_cd)</td>
							<td>~(pad.att_comment)</td>
					</tr>
					[/tlist_sql]
			</tbody>
	</table>
	<div id="legend">
        <h3>~[text:psx.common.legend]</h3>
        <p><strong>~[text:psx.html.admin_attendance_view.meeting.attendance_codes]</strong> ~[x:att_code_legend;studentschool]</p>
	</div>
</div>

<!--Potential meeting attendance update for v1.1
    This would pull the students entire schedule instead of only pulling sections for
    which attendance had been entered. This could allow teachers to see gaps where other
    teachers either didn't take attendace, assuming the student was absent in multiple
    classes for the day, or identify a student who is potential skipping intermittent
    classes throughout the day.

select s.external_expression, c.course_name, ad.attcode, ad.attcomment, ad.adminorteacher 
from cc cc
inner join sections s
  on cc.sectionid = s.id
inner join courses c
  on cc.course_number = c.course_number
left join (
  select 
    a.ccid as ccid,
    ac.att_code||' ('||ac.description||')' as attcode,
    a.att_comment as attcomment, 
    case when a.lock_teacher_YN = 1 then 'Admin' else 'Teacher' end as adminorteacher
  from attendance a
  inner join attendance_code ac
    on a.attendance_codeid = ac.id
  where a.studentid = ~(curstudid)
    and a.att_date = to_date('~(gpv.att_date;sqlText)','~[datetext:mmddyyyy]')
) ad on ad.ccid = cc.id
where cc.studentid = ~(curstudid)
  and to_date('~(gpv.att_date;sqlText)','~[datetext:mmddyyyy]') between cc.dateenrolled and cc.dateleft-1
order by s.external_expression;

-->